# æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> **ç›®çš„**: ç¾åœ¨ã®æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å…¨ä½“åƒã¨è©³ç´°ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’èª¬æ˜ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ãƒ•ãƒ­ãƒ¼](#2-æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ãƒ•ãƒ­ãƒ¼)
3. [å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°](#3-å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°)
4. [ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#4-ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#5-ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
6. [è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿](#6-è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿)
7. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#7-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
8. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#8-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)

---

## 1. æ¦‚è¦

### 1.1 æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç›®çš„

ARC-AGI2ã‚¿ã‚¹ã‚¯ã«å¯¾ã—ã¦ã€è¨“ç·´ãƒšã‚¢ï¼ˆè¤‡æ•°ã®å…¥å‡ºåŠ›ãƒšã‚¢ï¼‰ã‹ã‚‰å…±é€šã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ¨è«–ã—ã€ãƒ†ã‚¹ãƒˆå…¥åŠ›ã«å¯¾ã—ã¦æ­£ã—ã„å‡ºåŠ›ã‚’ç”Ÿæˆã™ã‚‹ã€‚

### 1.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã‚‹ï¼š

- **ProgramSynthesisEngine**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆæˆã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³
- **RuleBasedObjectMatcher**: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°
- **CandidateGenerator**: å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆå™¨
- **ConsistencyChecker**: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚«ãƒ¼
- **ComplexityRegularizer**: è¤‡é›‘åº¦æ­£å‰‡åŒ–å™¨
- **ProgramScorer**: å­¦ç¿’æ¸ˆã¿ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼

### 1.3 æ¨è«–ã®æµã‚Œï¼ˆæ¦‚è¦å›³ï¼‰

```
[å…¥åŠ›: Taskï¼ˆè¨“ç·´ãƒšã‚¢ + ãƒ†ã‚¹ãƒˆãƒšã‚¢ï¼‰]
    â†“
[ã‚¹ãƒ†ãƒƒãƒ—0: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°]
    â”œâ”€ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡º
    â”œâ”€ å¯¾å¿œé–¢ä¿‚æ¤œå‡º
    â”œâ”€ ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
    â””â”€ éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆï¼ˆæœ€å¤§930å€‹ â†’ é‡è¤‡æ’é™¤å¾Œ200-300å€‹ï¼‰
    â†“
[ã‚¹ãƒ†ãƒƒãƒ—1: å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆ]
    â”œâ”€ å„éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— å„è¨“ç·´ãƒšã‚¢ã®çµ„ã¿åˆã‚ã›
    â”œâ”€ 3ã¤ã®ç”Ÿæˆæ–¹æ³•ã‚’å®Ÿè¡Œ
    â”‚   â”œâ”€ â‘ æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰
    â”‚   â”œâ”€ â‘¡æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰
    â”‚   â””â”€ â‘¢æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ã‚°ãƒªãƒƒãƒ‰ï¼‰
    â”œâ”€ æœ€å¤§510å€‹/éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ /è¨“ç·´ãƒšã‚¢
    â””â”€ è¤‡é›‘åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§é¸å‡º â†’ æœ€å¤§10å€‹/éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ /è¨“ç·´ãƒšã‚¢
    â†“
[ã‚¹ãƒ†ãƒƒãƒ—2: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯]
    â”œâ”€ å…¨è¨“ç·´ãƒšã‚¢ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œ
    â””â”€ ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ï¼ˆ0.0-1.0ï¼‰ã‚’è¨ˆç®—
    â†“
[ã‚¹ãƒ†ãƒƒãƒ—3: æœ€è‰¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠ]
    â”œâ”€ ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ + ProgramScorerã‚¹ã‚³ã‚¢ã‚’çµ±åˆ
    â”œâ”€ è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’é©ç”¨
    â””â”€ æœ€çµ‚ã‚¹ã‚³ã‚¢ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    â†“
[å‡ºåŠ›: å…±é€šãƒ—ãƒ­ã‚°ãƒ©ãƒ ]
```

---

## 2. æ¨è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ãƒ•ãƒ­ãƒ¼

### 2.1 ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

æ¨è«–ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§é–‹å§‹ã•ã‚Œã‚‹ï¼š

1. **scripts/inference/inference.py**: ãƒ¡ã‚¤ãƒ³æ¨è«–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
2. **ProgramSynthesisEngine.synthesize_program()**: ç›´æ¥å‘¼ã³å‡ºã—
3. **ARCSolver.solve_task()**: ARCã‚½ãƒ«ãƒãƒ¼çµŒç”±

### 2.2 ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼

#### 2.2.1 åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º

```python
# 1. è¨­å®šã®èª­ã¿è¾¼ã¿
config = load_synthesis_config()  # YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿

# 2. ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿
neural_model = ProgramSynthesisModel(config)
neural_model.load_checkpoint(checkpoint_path)
neural_model.eval()

# 3. ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã®åˆæœŸåŒ–
tokenizer = ProgramTokenizer.load_vocab(vocab_path)

# 4. ProgramSynthesisEngineã®åˆæœŸåŒ–
engine = ProgramSynthesisEngine(
    config=config,
    neural_model=neural_model,
    tokenizer=tokenizer
)
```

#### 2.2.2 æ¨è«–å®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚º

```python
# Taskã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
task = Task(
    train=train_pairs,  # è¨“ç·´ãƒšã‚¢ã®ãƒªã‚¹ãƒˆ
    test=test_pairs,    # ãƒ†ã‚¹ãƒˆãƒšã‚¢ã®ãƒªã‚¹ãƒˆ
    task_id=task_id
)

# ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆæˆ
synthesized_program = engine.synthesize_program(task)
```

---

## 3. å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°

### 3.1 ã‚¹ãƒ†ãƒƒãƒ—0: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°

#### 3.1.1 ç›®çš„

è¨“ç·´ãƒšã‚¢é–“ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¯¾å¿œé–¢ä¿‚ã‚’æ¤œå‡ºã—ã€å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã¦éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆã™ã‚‹ã€‚

#### 3.1.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**: `RuleBasedObjectMatcher`

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**: `match_objects(task: Task) -> Dict[str, Any]`

**å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**:

1. **èƒŒæ™¯è‰²æ¨å®š**
   - å„ã‚°ãƒªãƒƒãƒ‰ï¼ˆå…¥åŠ›ãƒ»å‡ºåŠ›ï¼‰ã®èƒŒæ™¯è‰²ã‚’æ¨å®š
   - æˆ¦ç•¥: `unified`ï¼ˆå…¨ã‚°ãƒªãƒƒãƒ‰å…±é€šï¼‰ã¾ãŸã¯ `per_grid`ï¼ˆã‚°ãƒªãƒƒãƒ‰ã”ã¨ï¼‰
   - å®Ÿè£…: `BackgroundColorInferencer`

2. **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡º**
   - å„ã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŠ½å‡ºï¼ˆ4é€£çµã¾ãŸã¯8é€£çµï¼‰
   - èƒŒæ™¯è‰²ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é™¤å¤–
   - å®Ÿè£…: `ObjectExtractor`

3. **å¯¾å¿œé–¢ä¿‚æ¤œå‡º**
   - è¨“ç·´ãƒšã‚¢é–“ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¯¾å¿œé–¢ä¿‚ã‚’æ¤œå‡º
   - å¯¾å¿œã‚¿ã‚¤ãƒ—: 1å¯¾1ã€åˆ†å‰²ã€çµ±åˆã€æ¶ˆå¤±ã€æ–°è¦å‡ºç¾
   - å®Ÿè£…: `CorrespondenceDetector`

4. **ã‚«ãƒ†ã‚´ãƒªåˆ†é¡**
   - å¯¾å¿œé–¢ä¿‚ã«åŸºã¥ã„ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡
   - ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³æ•°:
     - 4é€£çµ: 463ãƒ‘ã‚¿ãƒ¼ãƒ³
     - 8é€£çµ: 463ãƒ‘ã‚¿ãƒ¼ãƒ³
     - åˆè¨ˆ: 926ãƒ‘ã‚¿ãƒ¼ãƒ³
   - å®Ÿè£…: `CategoryClassifier`

5. **éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆ**
   - å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆ
   - ç”Ÿæˆæ•°:
     - ã‚«ãƒ†ã‚´ãƒªãƒ™ãƒ¼ã‚¹: 926å€‹ï¼ˆ4é€£çµÃ—463 + 8é€£çµÃ—463ï¼‰
     - ãƒãƒ¼ã‚¸: 4å€‹ï¼ˆ`num_merge_partial_programs`ï¼‰
     - **åˆè¨ˆ: æœ€å¤§930å€‹**
   - é‡è¤‡æ’é™¤: å®Œå…¨ä¸€è‡´ã®éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é™¤å¤– â†’ **ç´„200-300å€‹**
   - å®Ÿè£…: `PartialProgramGenerator`

#### 3.1.3 å‡ºåŠ›

```python
{
    'success': bool,
    'partial_programs': List[str],  # éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªã‚¹ãƒˆ
    'categories': List[CategoryInfo],  # ã‚«ãƒ†ã‚´ãƒªæƒ…å ±
    'matching_info': Dict[str, Any],  # ãƒãƒƒãƒãƒ³ã‚°è©³ç´°æƒ…å ±
    'grid_info_cache': Dict[int, Dict],  # ã‚°ãƒªãƒƒãƒ‰æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    'all_partial_programs': List[str]  # ã™ã¹ã¦ã®éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆé‡è¤‡æ’é™¤å‰ï¼‰
}
```

### 3.2 ã‚¹ãƒ†ãƒƒãƒ—1: å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆ

#### 3.2.1 ç›®çš„

å„éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— å„è¨“ç·´ãƒšã‚¢ã®çµ„ã¿åˆã‚ã›ã«å¯¾ã—ã¦ã€è¤‡æ•°ã®å€™è£œç”Ÿæˆæ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆã™ã‚‹ã€‚

#### 3.2.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**: `CandidateGenerator`

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**: `generate_candidates(input_grid, output_grid, max_candidates, pair_index, partial_program, matching_result) -> List[str]`

**å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**:

1. **éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ‹¡å¼µ**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã‚ã‚‹å ´åˆã€å¤‰æ›æ“ä½œã‚’è¿½åŠ ã—ã¦å®Œå…¨ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆ
   - å®Ÿè£…: `_extend_partial_program()`

2. **ã‚·ãƒ¼ãƒ‰å¤‰å‹•**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - `enable_seed_variation`ãŒæœ‰åŠ¹ãªå ´åˆã€è¤‡æ•°ã®ã‚·ãƒ¼ãƒ‰ã§ç”Ÿæˆã‚’è©¦è¡Œ
   - ã‚·ãƒ¼ãƒ‰æ•°: `num_seeds_per_pair`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3ï¼‰

3. **å€™è£œç”Ÿæˆæ–¹æ³•ã®å®Ÿè¡Œ**

   **â‘ æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰**
   - å®Ÿè£…: `NeuralCandidateGenerator`
   - å…¥åŠ›: ã‚°ãƒªãƒƒãƒ‰ï¼ˆå…¥åŠ›ãƒ»å‡ºåŠ›ï¼‰
   - å‡ºåŠ›: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ—
   - æœ€å¤§å€™è£œæ•°:
     - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Š: 105å€‹ï¼ˆ`num_neural_candidates_with_partial`ï¼‰
     - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã—: 100å€‹ï¼ˆ`num_neural_candidates_without_partial`ï¼‰
   - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã®ç¶šãç”Ÿæˆ: âœ… å®Ÿè£…æ¸ˆã¿

   **â‘¡æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰**
   - å®Ÿè£…: `NeuralObjectCandidateGenerator`
   - å…¥åŠ›: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒªã‚¹ãƒˆï¼ˆå…¥åŠ›ãƒ»å‡ºåŠ›ï¼‰
   - å‡ºåŠ›: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ—
   - æœ€å¤§å€™è£œæ•°:
     - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Š: 105å€‹ï¼ˆ`num_neural_object_candidates_with_partial`ï¼‰
     - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã—: 100å€‹ï¼ˆ`num_neural_object_candidates_without_partial`ï¼‰
   - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã®ç¶šãç”Ÿæˆ: âœ… å®Ÿè£…æ¸ˆã¿

   **â‘¢æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ã‚°ãƒªãƒƒãƒ‰ï¼‰**
   - å®Ÿè£…: `GridToGridCandidateGenerator`
   - å…¥åŠ›: ã‚°ãƒªãƒƒãƒ‰ï¼ˆå…¥åŠ›ãƒ»å‡ºåŠ›ï¼‰
   - å‡ºåŠ›: ã‚°ãƒªãƒƒãƒ‰å¤‰æ›çµæœã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é€†æ¨è«–
   - æœ€å¤§å€™è£œæ•°: 100å€‹ï¼ˆ`num_grid_to_grid_candidates`ï¼‰

4. **é‡è¤‡é™¤å»**
   - åŒã˜ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯1ã¤ã«ã¾ã¨ã‚ã‚‹

5. **è¤‡é›‘åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°**
   - `ComplexityRegularizer`ã‚’ä½¿ç”¨ã—ã¦è¤‡é›‘åº¦ã‚¹ã‚³ã‚¢ï¼ˆ`final_score`ï¼‰ã‚’è¨ˆç®—
   - é«˜ã„é †ã«ã‚½ãƒ¼ãƒˆ
   - å®Ÿè£…: `rank_candidates_by_complexity()`

6. **å€™è£œæ•°ã®åˆ¶é™**
   - `max_candidates_per_pair`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10å€‹ï¼‰ã§åˆ¶é™

#### 3.2.3 å€™è£œæ•°ã®è¨ˆç®—

å„éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— å„è¨“ç·´ãƒšã‚¢ã®çµ„ã¿åˆã‚ã›ã«å¯¾ã—ã¦ï¼š

- **ç†è«–ä¸Šã®æœ€å¤§å€™è£œæ•°**: 510å€‹
  - â‘ æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹: 205å€‹ï¼ˆéƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Š105 + ãªã—100ï¼‰
  - â‘¡æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹: 205å€‹ï¼ˆéƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Š105 + ãªã—100ï¼‰
  - â‘¢æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹: 100å€‹
- **é¸å‡ºå¾Œã®å€™è£œæ•°**: æœ€å¤§10å€‹ï¼ˆ`max_candidates_per_pair`ï¼‰

**æœ€çµ‚çš„ãªå€™è£œæ•°**:
- ç†è«–ä¸Šã®æœ€å¤§: éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ•° Ã— è¨“ç·´ãƒšã‚¢æ•° Ã— `max_candidates_per_pair`
- ä¾‹: 200å€‹ã®éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— 3å€‹ã®è¨“ç·´ãƒšã‚¢ Ã— 10å€‹ = **6,000å€‹**

### 3.3 ã‚¹ãƒ†ãƒƒãƒ—2: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯

#### 3.3.1 ç›®çš„

ç”Ÿæˆã•ã‚ŒãŸå€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã™ã¹ã¦ã®è¨“ç·´ãƒšã‚¢ã§ä¸€è²«ã—ã¦å‹•ä½œã™ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚

#### 3.3.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**: `ConsistencyChecker`

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**: `check_consistency(program: str, task: Task) -> float`

**å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**:

1. **å„è¨“ç·´ãƒšã‚¢ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œ**
   - `ExecutorCore.execute_program()`ã‚’ä½¿ç”¨
   - å…¥åŠ›: è¨“ç·´ãƒšã‚¢ã®å…¥åŠ›ã‚°ãƒªãƒƒãƒ‰
   - å‡ºåŠ›: å®Ÿè¡Œçµæœã®ã‚°ãƒªãƒƒãƒ‰

2. **å‡ºåŠ›ã®ä¸€è‡´åº¦ã‚’è¨ˆç®—**
   - æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã¨å®Ÿéš›ã®å‡ºåŠ›ã‚’æ¯”è¼ƒ
   - ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã§ã®ä¸€è‡´åº¦ã‚’è¨ˆç®—
   - å®Ÿè£…: `_calculate_output_consistency()`

3. **ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ã®è¨ˆç®—**
   - å„è¨“ç·´ãƒšã‚¢ã®ä¸€è‡´åº¦ã‚¹ã‚³ã‚¢ã®å¹³å‡ã‚’è¨ˆç®—
   - ç¯„å›²: 0.0-1.0

4. **é–¾å€¤ãƒã‚§ãƒƒã‚¯**
   - `consistency_threshold`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.8ï¼‰ä»¥ä¸Šã®å ´åˆã€ä¸€è²«æ€§ã‚ã‚Šã¨åˆ¤å®š

#### 3.3.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½

- **ProgramExecutionCache**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œçµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ConsistencyCheckCache**: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥

### 3.4 ã‚¹ãƒ†ãƒƒãƒ—3: æœ€è‰¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠ

#### 3.4.1 ç›®çš„

ä¸€è²«æ€§ã®ã‚ã‚‹å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã€æœ€é©ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠã™ã‚‹ã€‚

#### 3.4.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**: `ProgramSynthesisEngine`

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**: `_select_best_program(consistent_programs: List[str], task: Task) -> Optional[str]`

**å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**ï¼ˆç²¾åº¦ã‚’æœ€å„ªå…ˆã«ã™ã‚‹æ–¹é‡ï¼‰:

1. **ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ã®è¨ˆç®—**
   - å„å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—

2. **ã‚±ãƒ¼ã‚¹åˆ†å²ã«ã‚ˆã‚‹é¸æŠ**:

   **â‘ ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ãŒ1.0ãŒ1ã¤ã®å ´åˆ**
   - ProgramScorerã¨è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’ç„¡è¦–
   - ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ãŒ1.0ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãã®ã¾ã¾æ¡ç”¨

   **â‘¡ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ãŒ1.0ãŒè¤‡æ•°ã®å ´åˆ**
   - ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ãŒ1.0ã®å€™è£œã®ä¸­ã‹ã‚‰é¸æŠ
   - æœ€çµ‚ã‚¹ã‚³ã‚¢ = ProgramScorerã‚¹ã‚³ã‚¢ï¼ˆ0.1ï¼‰- è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ Ã— `complexity_weight`
   - æœ€ã‚‚é«˜ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠ

   **â‘¢ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ãŒ1.0ãŒãªã—ã®å ´åˆ**
   - ã™ã¹ã¦ã®å€™è£œã‹ã‚‰é¸æŠ
   - æœ€çµ‚ã‚¹ã‚³ã‚¢ = ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ï¼ˆ0.9ï¼‰+ ProgramScorerã‚¹ã‚³ã‚¢ï¼ˆ0.1ï¼‰- è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ Ã— `complexity_weight`
   - æœ€ã‚‚é«˜ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠ

3. **ProgramScorerã‚¹ã‚³ã‚¢ã®è¨ˆç®—**ï¼ˆâ‘¡â‘¢ã®å ´åˆã®ã¿ï¼‰
   - å­¦ç¿’æ¸ˆã¿`ProgramScorer`ï¼ˆ14æ¬¡å…ƒMLPï¼‰ãŒå€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
   - ç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«: 14æ¬¡å…ƒï¼ˆå…¥åŠ›ã‚µã‚¤ã‚ºã€å‡ºåŠ›ã‚µã‚¤ã‚ºã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ã€è¤‡é›‘åº¦ãªã©ï¼‰

4. **è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã®é©ç”¨**ï¼ˆâ‘¡â‘¢ã®å ´åˆã®ã¿ï¼‰
   - `ComplexityRegularizer`ã‚’ä½¿ç”¨ã—ã¦è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’é©ç”¨
   - è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ = è¤‡é›‘åº¦ã‚¹ã‚³ã‚¢ Ã— `complexity_weight`

5. **ãƒ©ãƒ³ã‚­ãƒ³ã‚°**
   - æœ€çµ‚ã‚¹ã‚³ã‚¢ã®é«˜ã„é †ã«ã‚½ãƒ¼ãƒˆ
   - æœ€ä¸Šä½ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠ

#### 3.4.3 é«˜åº¦ãªå…±é€šéƒ¨åˆ†æŠ½å‡ºï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ä»¥ä¸‹ã®æ‰‹æ³•ã‚’è©¦è¡Œï¼š

1. **æ®µéšçš„é–¾å€¤ç·©å’Œ**
   - ä¸€è²«æ€§é–¾å€¤ã‚’å¾ã€…ã«ä¸‹ã’ãªãŒã‚‰ä¸€è‡´ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ¢ã™
   - å®Ÿè£…: `_progressive_threshold_relaxation()`

2. **ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° + ä»£è¡¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠ**
   - é¡ä¼¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã—ã€å„ã‚¯ãƒ©ã‚¹ã‚¿ã®ä»£è¡¨ã‚’é¸ã¶
   - å®Ÿè£…: `_cluster_and_select_representative()`

3. **LCSï¼ˆæœ€é•·å…±é€šéƒ¨åˆ†åˆ—ï¼‰æŠ½å‡º**
   - è¤‡æ•°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æœ€é•·å…±é€šéƒ¨åˆ†åˆ—ã‚’æŠ½å‡º
   - å®Ÿè£…: `_extract_lcs_consensus()`

---

## 4. ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 4.1 ProgramSynthesisEngine

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/synthesis_engine.py`

**å½¹å‰²**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆæˆã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `synthesize_program(task: Task) -> Optional[str]`: ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆæˆã®ãƒ¡ã‚¤ãƒ³å‡¦ç†
- `_generate_candidate_programs(task: Task, partial_programs: Dict, matching_result: Dict) -> List[str]`: å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆ
- `_filter_consistent_programs(candidate_programs: List[str], task: Task) -> List[str]`: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯
- `_select_best_program(consistent_programs: List[str], task: Task) -> Optional[str]`: æœ€è‰¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠ

### 4.2 RuleBasedObjectMatcher

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/object_matching/rule_based_matcher.py`

**å½¹å‰²**: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `match_objects(task: Task) -> Dict[str, Any]`: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†

**ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `ObjectExtractor`: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡º
- `SimilarityCalculator`: é¡ä¼¼åº¦è¨ˆç®—
- `CorrespondenceDetector`: å¯¾å¿œé–¢ä¿‚æ¤œå‡º
- `BackgroundColorInferencer`: èƒŒæ™¯è‰²æ¨å®š
- `CategoryClassifier`: ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
- `PartialProgramGenerator`: éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆ

### 4.3 CandidateGenerator

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/candidate_generator.py`

**å½¹å‰²**: å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”Ÿæˆå™¨ï¼ˆçµ±åˆã‚¯ãƒ©ã‚¹ï¼‰

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `generate_candidates(input_grid, output_grid, max_candidates, pair_index, partial_program, matching_result) -> List[str]`: å€™è£œç”Ÿæˆã®ãƒ¡ã‚¤ãƒ³å‡¦ç†
- `rank_candidates_by_complexity(programs: List[str], base_scores: List[float]) -> List[Dict]`: è¤‡é›‘åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°

**ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `NeuralCandidateGenerator`: æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰
- `NeuralObjectCandidateGenerator`: æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰
- `GridToGridCandidateGenerator`: æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ã‚°ãƒªãƒƒãƒ‰ï¼‰
- `ComplexityRegularizer`: è¤‡é›‘åº¦æ­£å‰‡åŒ–å™¨

### 4.4 ConsistencyChecker

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/consistency_checker.py`

**å½¹å‰²**: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚«ãƒ¼

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `check_consistency(program: str, task: Task) -> float`: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯
- `check_detailed_consistency(program: str, task: Task) -> Dict[str, Any]`: è©³ç´°ãªä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯

### 4.5 ComplexityRegularizer

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/complexity_regularizer.py`

**å½¹å‰²**: è¤‡é›‘åº¦æ­£å‰‡åŒ–å™¨

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `calculate_complexity_score(program: str) -> float`: è¤‡é›‘åº¦ã‚¹ã‚³ã‚¢ã®è¨ˆç®—
- `score_candidates(programs: List[str], base_scores: List[float]) -> List[Dict]`: å€™è£œã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°

### 4.6 ProgramScorer

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/learning/program_scorer/model.py`

**å½¹å‰²**: å­¦ç¿’æ¸ˆã¿ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ï¼ˆ14æ¬¡å…ƒMLPï¼‰

**å…¥åŠ›**: 14æ¬¡å…ƒç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«
- å…¥åŠ›ã‚µã‚¤ã‚ºï¼ˆé«˜ã•ã€å¹…ï¼‰
- å‡ºåŠ›ã‚µã‚¤ã‚ºï¼ˆé«˜ã•ã€å¹…ï¼‰
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ï¼ˆå‰ã€å¾Œã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œï¼‰
- å¹³å‡ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºï¼ˆå¹…ã€é«˜ã•ï¼‰
- æœ€å¤§ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºï¼ˆå¹…ã€é«˜ã•ï¼‰
- è¤‡é›‘åº¦ã‚¹ã‚³ã‚¢
- è¡Œæ•°
- æ–‡å­—æ•°

**å‡ºåŠ›**: ã‚¹ã‚³ã‚¢ï¼ˆ0.0-1.0ï¼‰

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 5.1 å…¥åŠ›ãƒ‡ãƒ¼ã‚¿

```python
Task {
    train: List[Dict[str, Any]]  # è¨“ç·´ãƒšã‚¢ã®ãƒªã‚¹ãƒˆ
        [
            {
                'input': List[List[int]],   # å…¥åŠ›ã‚°ãƒªãƒƒãƒ‰
                'output': List[List[int]]   # å‡ºåŠ›ã‚°ãƒªãƒƒãƒ‰
            },
            ...
        ],
    test: List[Dict[str, Any]],  # ãƒ†ã‚¹ãƒˆãƒšã‚¢ã®ãƒªã‚¹ãƒˆ
    task_id: str                 # ã‚¿ã‚¹ã‚¯ID
}
```

### 5.2 ä¸­é–“ãƒ‡ãƒ¼ã‚¿

#### 5.2.1 ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°çµæœ

```python
{
    'success': bool,
    'partial_programs': List[str],  # éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªã‚¹ãƒˆï¼ˆé‡è¤‡æ’é™¤å¾Œï¼‰
    'categories': List[CategoryInfo],
    'matching_info': Dict[str, Any],
    'grid_info_cache': Dict[int, Dict],  # ã‚°ãƒªãƒƒãƒ‰æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    'all_partial_programs': List[str]  # ã™ã¹ã¦ã®éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆé‡è¤‡æ’é™¤å‰ï¼‰
}
```

#### 5.2.2 å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ 

```python
List[str]  # å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªã‚¹ãƒˆ
```

#### 5.2.3 ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯çµæœ

```python
{
    'overall_score': float,  # ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ï¼ˆ0.0-1.0ï¼‰
    'pair_scores': List[float],  # å„è¨“ç·´ãƒšã‚¢ã®ã‚¹ã‚³ã‚¢
    'detailed_analysis': List[Dict],  # è©³ç´°åˆ†æçµæœ
    'consistency_variance': float,  # åˆ†æ•£
    'min_pair_score': float,  # æœ€å°ãƒšã‚¢ã‚¹ã‚³ã‚¢
    'max_pair_score': float  # æœ€å¤§ãƒšã‚¢ã‚¹ã‚³ã‚¢
}
```

### 5.3 å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿

```python
Optional[str]  # åˆæˆã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå¤±æ•—æ™‚ã¯Noneï¼‰
```

---

## 6. è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### 6.1 SynthesisConfig

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/synthesis_engine.py`

**ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|----------|------------|------|
| `max_candidates_per_pair` | 10 | å„éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— å„è¨“ç·´ãƒšã‚¢ã‹ã‚‰é¸å‡ºã•ã‚Œã‚‹æœ€å¤§å€™è£œæ•° |
| `max_synthesis_attempts` | 100 | æœ€å¤§åˆæˆè©¦è¡Œå›æ•° |
| `consistency_threshold` | 0.8 | ä¸€è²«æ€§é–¾å€¤ |
| `complexity_weight` | 0.3 | è¤‡é›‘åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã®é‡ã¿ |
| `enable_rule_based_object_matching` | True | ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ– |
| `enable_program_scorer` | True | ProgramScorerã‚’æœ‰åŠ¹åŒ– |
| `program_scorer_model_path` | "learning_outputs/program_scorer/program_scorer_latest.pt" | ProgramScorerãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ã‚¹ |
| `enable_parallel_processing` | True | ä¸¦åˆ—å‡¦ç†ã‚’æœ‰åŠ¹åŒ– |
| `parallel_max_workers` | 4 | ä¸¦åˆ—å‡¦ç†ã®æœ€å¤§ãƒ¯ãƒ¼ã‚«ãƒ¼æ•° |
| `enable_caching` | True | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ– |
| `cache_max_size` | 1000 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€å¤§ã‚µã‚¤ã‚º |
| `cache_ttl` | 3600.0 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®TTLï¼ˆç§’ï¼‰ |

### 6.2 CandidateConfig

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/program_synthesis/config.py`

**ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|----------|------------|------|
| `max_candidates` | 30 | æœ€å¤§å€™è£œæ•° |
| `enable_neural_generation` | True | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ã‚’æœ‰åŠ¹åŒ– |
| `enable_neural_object_generation` | True | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ†’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ã‚’æœ‰åŠ¹åŒ– |
| `enable_neural_grid_to_grid` | True | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ã‚°ãƒªãƒƒãƒ‰ï¼‰ã‚’æœ‰åŠ¹åŒ– |
| `num_neural_candidates_with_partial` | 20 | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆéƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Šï¼‰ã®æœ€å¤§å€™è£œæ•° |
| `num_neural_candidates_without_partial` | 20 | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆéƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã—ï¼‰ã®æœ€å¤§å€™è£œæ•° |
| `num_neural_object_candidates_with_partial` | 20 | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ã‚Šï¼‰ã®æœ€å¤§å€™è£œæ•° |
| `num_neural_object_candidates_without_partial` | 20 | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã—ï¼‰ã®æœ€å¤§å€™è£œæ•° |
| `num_grid_to_grid_candidates` | 20 | æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ï¼ˆã‚°ãƒªãƒƒãƒ‰â†’ã‚°ãƒªãƒƒãƒ‰ï¼‰ã®æœ€å¤§å€™è£œæ•° |
| `num_seeds_per_pair` | 3 | å„éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ  Ã— å„è¨“ç·´ãƒšã‚¢ã‚ãŸã‚Šã®ã‚·ãƒ¼ãƒ‰æ•° |
| `enable_seed_variation` | True | ã‚·ãƒ¼ãƒ‰å¤‰å‹•ã‚’æœ‰åŠ¹åŒ– |

### 6.3 ObjectMatchingConfig

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/hybrid_system/inference/object_matching/config.py`

**ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|----------|------------|------|
| `num_category_patterns_4` | 463 | 4é€£çµã®ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³æ•° |
| `num_category_patterns_8` | 463 | 8é€£çµã®ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³æ•° |
| `num_merge_partial_programs` | 4 | ãƒãƒ¼ã‚¸ç”¨ã®éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ•° |

---

## 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 7.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®éšå±¤

1. **ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼**
   - `ExecutorCore.execute_program()`ã§ç™ºç”Ÿ
   - ã‚­ãƒ£ãƒƒãƒã—ã¦`None`ã‚’è¿”ã™
   - ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ã¯0.0

2. **å€™è£œç”Ÿæˆã‚¨ãƒ©ãƒ¼**
   - å„å€™è£œç”Ÿæˆæ–¹æ³•ã§ç™ºç”Ÿ
   - ã‚­ãƒ£ãƒƒãƒã—ã¦ç©ºã®ãƒªã‚¹ãƒˆã‚’è¿”ã™
   - ä»–ã®ç”Ÿæˆæ–¹æ³•ã¯ç¶™ç¶š

3. **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒ©ãƒ¼**
   - `RuleBasedObjectMatcher.match_objects()`ã§ç™ºç”Ÿ
   - ã‚­ãƒ£ãƒƒãƒã—ã¦`{'success': False}`ã‚’è¿”ã™
   - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã—ã§å€™è£œç”Ÿæˆã‚’ç¶™ç¶š

4. **ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼**
   - `ConsistencyChecker.check_consistency()`ã§ç™ºç”Ÿ
   - ã‚­ãƒ£ãƒƒãƒã—ã¦0.0ã‚’è¿”ã™

### 7.2 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

- ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€é«˜åº¦ãªå…±é€šéƒ¨åˆ†æŠ½å‡ºã‚’è©¦è¡Œ
- ãã‚Œã§ã‚‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€`None`ã‚’è¿”ã™

---

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 8.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½

- **ProgramExecutionCache**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œçµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ObjectExtractionCache**: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡ºçµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ConsistencyCheckCache**: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥

### 8.2 ä¸¦åˆ—å‡¦ç†

- **ParallelExecutor**: ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã‚’ä¸¦åˆ—å®Ÿè¡Œ
- æœ€å¤§ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°: `parallel_max_workers`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 4ï¼‰

### 8.3 ãƒ¡ãƒ¢ãƒªç®¡ç†

- **MemoryManager**: ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç›£è¦–
- ãƒ¡ãƒ¢ãƒªåˆ¶é™: `memory_limit_mb`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2048MBï¼‰

### 8.4 çµ±è¨ˆæƒ…å ±

- åˆæˆçµ±è¨ˆ: `synthesis_stats`
- ç”Ÿæˆçµ±è¨ˆ: `generation_stats`
- ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯çµ±è¨ˆ: `check_stats`

---

## 9. å®Ÿè¡Œä¾‹

### 9.1 åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹

```python
from src.hybrid_system.inference.program_synthesis import ProgramSynthesisEngine
from src.hybrid_system.core.data_structures import Task

# ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–
engine = ProgramSynthesisEngine(
    config_file='configs/synthesis_config.yaml',
    neural_model=neural_model,
    tokenizer=tokenizer
)

# ã‚¿ã‚¹ã‚¯ã®ä½œæˆ
task = Task(
    train=[
        {'input': input_grid_1, 'output': output_grid_1},
        {'input': input_grid_2, 'output': output_grid_2}
    ],
    test=[{'input': test_input_grid}],
    task_id='task_001'
)

# ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆæˆ
synthesized_program = engine.synthesize_program(task)

if synthesized_program:
    print(f"åˆæˆã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ :\n{synthesized_program}")
else:
    print("ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆæˆã«å¤±æ•—ã—ã¾ã—ãŸ")
```

### 9.2 çµ±è¨ˆæƒ…å ±ã®å–å¾—

```python
# åˆæˆçµ±è¨ˆã‚’å–å¾—
synthesis_stats = engine.get_synthesis_statistics()
print(f"æˆåŠŸç‡: {synthesis_stats['success_rate']:.2%}")
print(f"å¹³å‡åˆæˆæ™‚é–“: {synthesis_stats['average_synthesis_time']:.2f}ç§’")
print(f"å¹³å‡å€™è£œæ•°: {synthesis_stats['average_candidates_generated']:.0f}å€‹")

# ç”Ÿæˆçµ±è¨ˆã‚’å–å¾—
generation_stats = engine.candidate_generator.get_generation_statistics()
print(f"ç”ŸæˆæˆåŠŸç‡: {generation_stats['success_rate']:.2%}")
print(f"ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ç”Ÿæˆæ•°: {generation_stats['neural_generations']}å€‹")
```

---

## 10. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 10.1 ã‚ˆãã‚ã‚‹å•é¡Œ

1. **å€™è£œãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç”Ÿæˆã•ã‚Œãªã„**
   - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°ãŒå¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§
   - éƒ¨åˆ†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
   - ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦åŸå› ã‚’ç‰¹å®š

2. **ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè¦‹ã¤ã‹ã‚‰ãªã„**
   - `consistency_threshold`ã‚’ä¸‹ã’ã‚‹
   - é«˜åº¦ãªå…±é€šéƒ¨åˆ†æŠ½å‡ºã‚’æœ‰åŠ¹åŒ–
   - å€™è£œç”Ÿæˆæ•°ã‚’å¢—ã‚„ã™

3. **å®Ÿè¡Œæ™‚é–“ãŒé•·ã„**
   - ä¸¦åˆ—å‡¦ç†ã‚’æœ‰åŠ¹åŒ–
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
   - `max_candidates_per_pair`ã‚’æ¸›ã‚‰ã™

### 10.2 ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```python
config = SynthesisConfig(
    enable_debug_mode=True,
    enable_logging=True,
    log_dir='logs/synthesis'
)

engine = ProgramSynthesisEngine(config=config)
```

---

## 11. æ›´æ–°å±¥æ­´

- **v1.0** (2025-01-XX): åˆç‰ˆä½œæˆ

---

## 12. å‚è€ƒè³‡æ–™

- [çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆæ›¸](./unified_pipeline_design.md)
- [çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆæ›¸ï¼ˆè©³ç´°ç‰ˆï¼‰](./unified_pipeline_design_detailed.md)
- [ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹å€™è£œç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ](./rule_based_candidate_generation_algorithm.md)
- [ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒãƒƒãƒãƒ³ã‚°è¨­è¨ˆ](./object_matching_design.md)
