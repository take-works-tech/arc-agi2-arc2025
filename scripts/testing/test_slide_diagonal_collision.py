"""
SLIDEコマンドの斜め方向衝突判定のテスト

問題点の確認:
1. 斜め移動で障害物の「角」に当たった場合の判定
2. 中間ピクセルのチェックが必要かどうか
"""
import sys
from pathlib import Path

# プロジェクトルートをパスに追加
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

def test_diagonal_collision_scenario():
    """斜め方向の衝突判定シナリオをテスト"""

    print("=" * 60)
    print("SLIDEコマンドの斜め方向衝突判定のテスト")
    print("=" * 60)

    # シナリオ1: 障害物の「角」に当たる場合
    print("\n【シナリオ1】障害物の「角」に当たる場合")
    print("現在位置: (5, 5)")
    print("移動方向: XY (右下, dx=1, dy=1)")
    print("障害物: (6, 5) と (5, 6)（角）")
    print("次の位置: (6, 6)（障害物ではない）")
    print("\n現在の実装:")
    print("  - (6, 6)が障害物かチェック → 障害物ではない")
    print("  - 結果: 通過してしまう（問題）")
    print("\n期待される動作:")
    print("  - (6, 6)が障害物でなくても、隣接する(6, 5)や(5, 6)が障害物なら衝突")
    print("  - 結果: 衝突して停止")

    # シナリオ2: 中間ピクセルを通過する場合
    print("\n【シナリオ2】中間ピクセルを通過する場合")
    print("現在位置: (5, 5)")
    print("移動方向: XY (右下, dx=1, dy=1)")
    print("障害物: (6, 5)（中間ピクセル）")
    print("次の位置: (6, 6)")
    print("\n現在の実装:")
    print("  - (6, 6)が障害物かチェック → 障害物ではない")
    print("  - 結果: 通過してしまう（問題）")
    print("\n期待される動作:")
    print("  - 斜め移動の経路上の(6, 5)が障害物なら衝突")
    print("  - 結果: 衝突して停止")

    # シナリオ3: 正常な斜め移動
    print("\n【シナリオ3】正常な斜め移動")
    print("現在位置: (5, 5)")
    print("移動方向: XY (右下, dx=1, dy=1)")
    print("障害物: なし")
    print("次の位置: (6, 6)")
    print("\n現在の実装:")
    print("  - (6, 6)が障害物かチェック → 障害物ではない")
    print("  - 結果: 正常に移動（OK）")

    print("\n" + "=" * 60)
    print("推奨される改善")
    print("=" * 60)
    print("\n斜め方向の衝突判定を改善する方法:")
    print("1. 隣接ピクセルチェック:")
    print("   - 斜め移動の場合、隣接するピクセル((x+1, y)や(x, y+1))もチェック")
    print("   - いずれかが障害物なら衝突と判定")
    print("\n2. ブレゼンハムアルゴリズムを使用:")
    print("   - CREATE_LINEと同様に、経路上のすべてのピクセルをチェック")
    print("   - より正確だが、実装が複雑")
    print("\n3. 簡易的な方法（推奨）:")
    print("   - 斜め移動の場合、次の位置と隣接する2つのピクセルをチェック")
    print("   - いずれかが障害物なら衝突と判定")
    print("   - 実装が簡単で、ARCタスクには十分")

    return True


if __name__ == "__main__":
    test_diagonal_collision_scenario()
